# Docker Compose 配置
# 默认配置：仅启动 Django + Nginx（不启动 Redis/Celery）
# 如需启用异步服务，使用: docker compose -f docker-compose.yml -f docker-compose.with-async.yml up

services:
  mainservice:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - ENABLE_ASYNC_SERVICES=${ENABLE_ASYNC_SERVICES:-false}
      - REDIS_SERVER_URL=${REDIS_SERVER_URL:-redisserver}
    volumes:
      - .:/app
    networks:
      - shared-net

  nginxserver:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./staticfiles:/etc/staticfiles
      - ./media:/etc/media
    depends_on:
      mainservice:
        condition: service_started
    networks:
      - shared-net


networks:
  shared-net:
    driver: bridge